{% extends 'base.html' %}
{% load static %}

{% block title %}
    Хранилище
{% endblock %}

{% block content %}
    <link rel="stylesheet" href="{% static 'css/app/app.css' %}">
    <div class="container">
        <div class="row">
            <div class="col">
                <h3>Ваши продукты</h3>
            </div>
            <div class="col text-end" id="add-more-products-div"></div>
            <hr>
        </div>
        <div class="row justify-content-center">
            <div class="col">
                <div id="productsTimeLine" class="row justify-content-center mt-5">
                    <div class="spinner-border text-apple" role="status"></div>
                </div>
            </div>
        </div>
    </div>
    <!-- New product card modal -->
    {% if user.is_authenticated %}
        <div class="modal fade" id="newProductModal"
             data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
             aria-labelledby="newProductCardModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title text-center mx-auto" id="newProductCardModalLabel">
                            Добавить продукт
                        </h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"
                                style="margin-left: 0"
                                aria-label="Close"></button>
                    </div>
                    <form method="post" id="newProductCardForm" class="modal-form" enctype="multipart/form-data">
                        {% csrf_token %}
                        <div class="modal-body mx-auto text-center w-50">
                            <div class="row">
                                <div class="col">
                                    Продукт
                                </div>
                                <div class="col">
                                    {{ form.product_card }}
                                </div>
                                {{ form.product_card.errors }}
                            </div>
                            <div class="row">
                                <div class="col">
                                    {{ form.amount.label_tag }}
                                </div>
                                <div class="col-7 d-flex align-center justify-content-center">
                                    {{ form.amount }}
                                    <span class="mx-2"></span>{{ form.amount_unit }}
                                </div>
                                {{ form.amount.errors}}
                                {{ form.amount_unit.errors }}
                            </div>
                            <div class="row">
                                <div class="col">
                                    {{ form.production_date.label_tag }}
                                </div>
                                <div class="col-7 d-flex">
                                    {{ form.production_date }}
                                </div>
                                {{ form.production_date.errors }}
                            </div>
                            <div class="row">
                                <div class="col">
                                    {{ form.purchase_date.label_tag }}
                                </div>
                                <div class="col-7 d-flex">
                                    {{ form.purchase_date }}
                                </div>
                                {{ form.purchase_date.errors }}
                            </div>
                            <div>
                                {{ form.captcha }}
                                {{ form.captcha.errors }}
                            </div>
                        </div>
                        <div class="modal-footer justify-content-center">
                            <button type="submit" class="btn btn-apple">Сохранить</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <!-- New product saving notification -->
        {% if saved == True %}
            <div class="modal fade" id="notificationModal" tabindex="-1"
                 aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">Продукт добавлен</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"
                                aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            Для изменения или удаления продукта нажмите на него в списке продуктов
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-apple"
                                    data-bs-dismiss="modal">Хорошо</button>
                        </div>
                    </div>
                </div>
            </div>
            <script>
                let notificationModal = new bootstrap.Modal(
                    document.getElementById('notificationModal'), {
                    keyboard: false
                });
                notificationModal.show()
            </script>
        {% elif saved == False %}
            <script>
                let newProductModal = new bootstrap.Modal(
                    document.getElementById('newProductModal'), {
                    keyboard: false
                });
                newProductModal.show()
            </script>
        {% endif %}
    {% endif %}
    <script type="text/babel" src="{% static 'js/app/app.js' %}"></script>
{% endblock %}
